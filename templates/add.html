<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/k&d.png') }}">
    <style>
      .add-header {
        display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;
      }
      .add-header h2 { margin: 0; }
      .add-plus {
        font-size: 2.2rem; color: #007bff; cursor: pointer; border-radius: 50%; background: #f4f4f4; border: 2px solid #007bff; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; transition: background 0.2s, color 0.2s;
      }
      .add-plus:hover { background: #007bff; color: #fff; }
      .your-products { margin-bottom: 32px; }
      #loader-bg {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: #fff;
        z-index: 5000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.4s;
      }
      #loader-bg img {
        width: 80px; height: 80px; object-fit: contain;
        margin-bottom: 24px;
        display: block;
      }
      .loader-spinner {
        width: 38px; height: 38px;
        border: 4px solid #007bff;
        border-top: 4px solid #e0e0e0;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      @keyframes loaderPulse {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.08); opacity: 0.85; }
      }
      .back-dashboard {
        display: inline-block;
        margin-top: 16px;
        padding: 10px 20px;
        background: #007bff;
        color: #fff;
        text-align: center;
        border-radius: 4px;
        text-decoration: none;
        transition: background 0.3s;
      }
      .back-dashboard:hover {
        background: #0056b3;
      }
      .main-nav {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #007bff;
        padding: 12px 0;
        border-radius: 0 0 12px 12px;
        margin-bottom: 32px;
        position: relative;
      }
      .nav-links {
        display: flex;
        gap: 10px;
      }
      .main-nav a {
        color: #fff;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 500;
        transition: background 0.2s;
        margin: 0 2px;
      }
      .main-nav a:hover, .main-nav a.active {
        background: #0056b3;
      }
      .nav-hamburger {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 36px;
        height: 36px;
        margin-right: 12px;
        cursor: pointer;
      }
      .nav-hamburger span {
        display: block;
        width: 28px;
        height: 4px;
        background: #fff;
        margin: 3px 0;
        border-radius: 2px;
        transition: 0.3s;
      }
      @media (max-width: 700px) {
        .main-nav {
          flex-direction: row;
          padding: 8px 0;
        }
        .nav-hamburger {
          display: flex;
        }
        .nav-links {
          display: none;
          flex-direction: column;
          position: absolute;
          top: 48px;
          left: 0;
          width: 100vw;
          background: #007bff;
          z-index: 1001;
          border-radius: 0 0 12px 12px;
        }
        .nav-links.show {
          display: flex;
        }
        .main-nav a {
          margin: 0;
          padding: 14px 0;
          border-radius: 0;
          border-bottom: 1px solid #0056b3;
        }
      }
    </style>
</head>
<body>
    <nav class="main-nav">
      <div class="nav-hamburger" onclick="toggleNavMenu()">
        <span></span><span></span><span></span>
      </div>
      <div class="nav-links">
        <a href="/dashboard" {% if request.path=='/dashboard' %}class="active"{% endif %}>Dashboard</a>
        <a href="/add" {% if request.path=='/add' %}class="active"{% endif %}>Add Product</a>
        <a href="/orders" {% if request.path=='/orders' %}class="active"{% endif %}>Orders</a>
        <a href="/profile" {% if request.path=='/profile' %}class="active"{% endif %}>Profile</a>
      </div>
    </nav>
    <div class="container">
      <div class="add-header">
        <h2>Your Products</h2>
        <span class="add-plus" id="openAddModal">+</span>
      </div>
      <div class="product-grid your-products">
        {% for item in data %}
            <div class="card">
                <img src="{{ url_for('static', filename='images/' ~ item.image_path) }}" alt="" height="100px" width="200px">
                <div class="card-body">
                    <h3>{{ item.product_name }}</h3>
                    <p>Price: {{ item.product_price }}</p>
                    <p>Stock: {{ item.stock }}</p>
                    <div style="display:flex;gap:8px;justify-content:center;margin-top:10px;">
                      <a href="{{ url_for('edit_product', idx=loop.index0) }}" class="back-dashboard" style="padding:6px 16px;font-size:0.95rem;background:#ffc107;color:#222;">Edit</a>
                      <form action="{{ url_for('delete_product', idx=loop.index0) }}" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this product?');" style="padding:6px 16px;font-size:0.95rem;background:#dc3545;">Delete</button>
                      </form>
                    </div>
                </div>
            </div>
        {% endfor %}
      </div>
      <a href="/dashboard" class="back-dashboard">Back to Dashboard</a>
    </div>
    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeAddModal">&times;</span>
        <h2>Add Product</h2>
        <form action="/add_product" method="post" enctype="multipart/form-data" id="addProductForm">
            <label>Image: <input type="file" name="product_image" accept="image/*" required></label>
            <label>Name: <input type="text" name="product_name" required></label>
            <label>Price: <input type="number" name="product_price" required></label>
            <label>Stock: <input type="number" name="stock" required></label>
            <button type="submit">Add</button>
        </form>
      </div>
    </div>
    <!-- Loader -->
    <div id="loader-bg">
      <img src="{{ url_for('static', filename='images/k&d.png') }}" alt="K&D Logo">
      <div class="loader-spinner"></div>
    </div>
    <script>
      document.getElementById('openAddModal').onclick = function() {
        document.getElementById('addProductModal').style.display = 'block';
      };
      document.getElementById('closeAddModal').onclick = function() {
        document.getElementById('addProductModal').style.display = 'none';
      };
      window.onclick = function(event) {
        if (event.target == document.getElementById('addProductModal')) {
          document.getElementById('addProductModal').style.display = 'none';
        }
      };
      window.addEventListener('load', function() {
        setTimeout(function() {
          document.getElementById('loader-bg').style.opacity = 0;
          setTimeout(function() {
            document.getElementById('loader-bg').style.display = 'none';
          }, 400);
        }, 400); // loader stays at least 400ms
      });
      function toggleNavMenu() {
        var navLinks = document.querySelector('.nav-links');
        navLinks.classList.toggle('show');
      }
    </script>
</body>
</html>